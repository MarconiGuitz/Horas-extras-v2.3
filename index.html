<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horas Extras GT</title>

<link rel="manifest" href="manifest.json">

<style>
body{
    font-family: system-ui, sans-serif;
    background: linear-gradient(135deg,#ffffff,#000000);
    margin:0;padding:20px
}
.container{
    max-width:700px;
    margin:auto;
    background:#fff;
    border-radius:20px;
    box-shadow:0 20px 50px rgba(0,0,0,.3);
    overflow:hidden
}
.header{
    background:linear-gradient(135deg,#000000,#82d8a6);
    color:#fff;
    padding:25px;
    text-align:center
}
.tabs{display:flex;background:#f1f1f1}
.tab{
    flex:1;padding:15px;border:none;
    background:none;font-weight:600;
    cursor:pointer;color:#666
}
.tab.active{
    background:#fff;
    color:#000000;
    border-bottom:3px solid #dbdbdb
}
.content{padding:20px}
.section{display:none}
.section.active{display:block}
label{font-weight:600;margin-bottom:5px;display:block}
input,select,textarea{
    width:100%;padding:12px;
    border-radius:10px;
    border:2px solid #eaeaea;
    margin-bottom:15px;
    font-size:16px
}
textarea{resize:vertical}
button{
    width:100%;padding:15px;
    border:none;border-radius:10px;
    background:linear-gradient(135deg,#000000,#979699);
    color:#fff;font-size:16px;
    font-weight:600;cursor:pointer
}
.btn-cerrar{
    background:linear-gradient(135deg,#7a0000,#c0392b);
    margin-top:10px
}
.resultado{
    background:linear-gradient(135deg,#b9c7b7,#599271);
    color:#fff;
    padding:20px;border-radius:15px
}
.resultado-item{
    display:flex;justify-content:space-between;
    padding:8px 0;border-bottom:1px solid rgba(255,255,255,.3)
}
.resultado-item:last-child{
    border:none;font-size:18px;font-weight:700
}
.registro{
    background:#f8f9fa;padding:15px;
    border-radius:10px;margin-bottom:10px
}
small{color:#666}
hr{border:1px solid rgba(255,255,255,.3);margin:15px 0}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h2>üí∞ Horas Extras Guatemala</h2>
<p>Control mensual en Quetzales (Q)</p>
</div>

<div class="tabs">
<button class="tab active" onclick="tab('config',this)">‚öôÔ∏è Config</button>
<button class="tab" onclick="tab('registro',this)">‚ûï Registro</button>
<button class="tab" onclick="tab('historial',this)">üìä Historial</button>
<button class="tab" onclick="tab('resumen',this)">üíµ Resumen</button>
</div>

<div class="content">

<!-- CONFIG -->
<div id="config" class="section active">

<label>Sueldo base mensual (Q)</label>
<input id="sueldoBase" type="number">

<label>IGSS (%)</label>
<input id="porcentajeIGSS" value="4.83">

<label>ISR (%)</label>
<input id="porcentajeISR" value="5">

<hr>

<label>Pr√©stamos / otros descuentos (Q)</label>
<input id="descuentoFijo" type="number" value="0">

<label>Ahorro mensual (Q)</label>
<input id="ahorroMensual" type="number" value="0">

<label>Ahorro acumulado actual (Q)</label>
<input id="ahorroAcumulado" type="number" value="0">

<button onclick="guardarConfig()">Guardar configuraci√≥n</button>
<button class="btn-cerrar" onclick="cerrarMes()">üìÜ Cerrar mes</button>

</div>

<!-- REGISTRO -->
<div id="registro" class="section">
<label>Fecha</label>
<input id="fecha" type="date">

<label>Horas diurnas</label>
<input id="hd" type="number" step="0.5" value="0">

<label>Horas nocturnas</label>
<input id="hn" type="number" step="0.5" value="0">

<label>Motivo</label>
<textarea id="desc"></textarea>

<button onclick="registrar()">Registrar horas</button>
</div>

<!-- HISTORIAL -->
<div id="historial" class="section">
<div id="lista"></div>
</div>

<!-- RESUMEN -->
<div id="resumen" class="section">
<div id="resultado"></div>
</div>

</div>
</div>

<script>
let config={}, registros=[];

/* INIT */
window.onload=()=>{
    fecha.valueAsDate=new Date();
    config=JSON.parse(localStorage.getItem('config')||'{}');
    registros=JSON.parse(localStorage.getItem('registros')||'[]');

    if(config.sueldoBase){
        sueldoBase.value=config.sueldoBase;
        porcentajeIGSS.value=config.porcentajeIGSS;
        porcentajeISR.value=config.porcentajeISR;
        descuentoFijo.value=config.descuentoFijo;
        ahorroMensual.value=config.ahorroMensual;
        ahorroAcumulado.value=config.ahorroAcumulado;
    }
    mostrarHistorial();
};

/* TABS */
function tab(id,el){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    el.classList.add('active');
    if(id==='resumen') resumen();
}

/* CONFIG */
function guardarConfig(){
    config={
        sueldoBase:+sueldoBase.value,
        porcentajeIGSS:+porcentajeIGSS.value,
        porcentajeISR:+porcentajeISR.value,
        descuentoFijo:+descuentoFijo.value,
        ahorroMensual:+ahorroMensual.value,
        ahorroAcumulado:+ahorroAcumulado.value
    };
    localStorage.setItem('config',JSON.stringify(config));
    alert('Configuraci√≥n guardada');
}

/* CERRAR MES */
function cerrarMes(){
    if(!confirm('¬øCerrar el mes y sumar el ahorro?')) return;

    config.ahorroAcumulado += config.ahorroMensual;
    localStorage.setItem('config',JSON.stringify(config));

    registros=[];
    localStorage.setItem('registros',JSON.stringify(registros));

    alert('Mes cerrado correctamente');
    mostrarHistorial();
}

/* REGISTROS */
function registrar(){
    registros.push({
        fecha:fecha.value,
        hd:+hd.value,
        hn:+hn.value,
        desc:desc.value,
        md:+hd.value*(config.sueldoBase/30/8*1.5),
        mn:+hn.value*(config.sueldoBase/30/8*2)
    });
    localStorage.setItem('registros',JSON.stringify(registros));
    hd.value=hn.value=0;desc.value='';
    mostrarHistorial();
}

/* HISTORIAL */
function mostrarHistorial(){
    lista.innerHTML='';
    registros.forEach((r,i)=>{
        lista.innerHTML+=`
        <div class="registro">
        <b>${r.fecha}</b><br>
        ‚òÄÔ∏è ${r.hd}h Q${r.md.toFixed(2)}<br>
        üåô ${r.hn}h Q${r.mn.toFixed(2)}<br>
        <small>${r.desc}</small>
        </div>`;
    });
}

/* RESUMEN */
function resumen(){

    // HORAS
    let horasD = registros.reduce((s,r)=>s+r.hd,0);
    let horasN = registros.reduce((s,r)=>s+r.hn,0);

    let totalD = registros.reduce((s,r)=>s+r.md,0);
    let totalN = registros.reduce((s,r)=>s+r.mn,0);
    let totalExtras = totalD + totalN;

    // DEVENGADO
    let dev = config.sueldoBase + totalExtras;

    // DESCUENTOS (SOLO 2¬™ QUINCENA)
    let igss = dev * (config.porcentajeIGSS / 100);
    let isr  = (dev - igss) * (config.porcentajeISR / 100);

    let descuentosTotales =
        igss +
        isr +
        config.descuentoFijo +
        config.ahorroMensual;

    // QUINCENAS
    let primeraQuincena = dev / 2;              // SIN descuentos
    let segundaQuincena = primeraQuincena - descuentosTotales;

    // NETO MENSUAL
    let netoMensual = primeraQuincena + segundaQuincena;

    resultado.innerHTML = `
    <!-- AHORRO ACUMULADO ARRIBA -->
    <div class="resultado" style="margin-bottom:15px">
        <div class="resultado-item" style="font-size:20px;font-weight:700">
            <span>üè¶ Ahorro acumulado</span>
            <span>Q${config.ahorroAcumulado.toFixed(2)}</span>
        </div>
    </div>

    <!-- DESGLOSE DEL MES -->
    <div class="resultado">

        <div class="resultado-item">
            <span>Sueldo base</span>
            <span>Q${config.sueldoBase.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>‚òÄÔ∏è Horas diurnas (${horasD}h)</span>
            <span>Q${totalD.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>üåô Horas nocturnas (${horasN}h)</span>
            <span>Q${totalN.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>Total horas extras</span>
            <span>Q${totalExtras.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>üí∞ Devengado mensual</span>
            <span>Q${dev.toFixed(2)}</span>
        </div>

        <hr>

        <div class="resultado-item">
            <span>üí∏ 1¬™ quincena (sin descuentos)</span>
            <span>Q${primeraQuincena.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>üí∏ 2¬™ quincena (con descuentos)</span>
            <span>Q${segundaQuincena.toFixed(2)}</span>
        </div>

        <hr>

        <div class="resultado-item">
            <span>IGSS</span>
            <span>-Q${igss.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>ISR</span>
            <span>-Q${isr.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>Pr√©stamos / otros</span>
            <span>-Q${config.descuentoFijo.toFixed(2)}</span>
        </div>

        <div class="resultado-item">
            <span>Ahorro mensual</span>
            <span>-Q${config.ahorroMensual.toFixed(2)}</span>
        </div>

        <div class="resultado-item" style="font-size:18px;font-weight:700">
            <span>‚úÖ L√≠quido mensual</span>
            <span>Q${netoMensual.toFixed(2)}</span>
        </div>

    </div>
    `;
}

</script>

</body>
</html>
